YUI.add("hermes-template-user-account-card",function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,n,s){var l;return'\t\t\t<div class="pro-since-container">\n'+(null!=(l=t.invokePartial(n["pro-badge"],a,{name:"pro-badge",data:s,indent:"\t\t\t\t",helpers:e,partials:n,decorators:t.decorators}))?l:"")+"\t\t\t\t<span>TMP SINCE 2018<span>\n\t\t\t</div>\n"},3:function(t,a,e,n,s){var l;return'\t\t\t<div class="space-used-text">TMP '+t.escapeExpression("function"==typeof(l=null!=(l=e.storageUsedFormatted||(null!=a?a.storageUsedFormatted:a))?l:e.helperMissing)?l.call(null!=a?a:{},{name:"storageUsedFormatted",hash:{},data:s}):l)+" used</div>\n"},5:function(t,a,e,n,s){var l,i=null!=a?a:{},r=e.helperMissing,o=t.escapeExpression;return'\t\t\t<div class="graph-container">\n\t\t\t\t<div class="graph"></div>\n\t\t\t</div>\n\t\t\t<div class="details-container">\n\t\t\t\t<p class="space-used-text">\n\t\t\t\t\tTMP '+o("function"==typeof(l=null!=(l=e.storageUsedFormatted||(null!=a?a.storageUsedFormatted:a))?l:r)?l.call(i,{name:"storageUsedFormatted",hash:{},data:s}):l)+" used of "+o("function"==typeof(l=null!=(l=e.storageTotalFormatted||(null!=a?a.storageTotalFormatted:a))?l:r)?l.call(i,{name:"storageTotalFormatted",hash:{},data:s}):l)+'\n\t\t\t\t</p>\n\t\t\t\t<a href="#" class="unlimited-storage-link">\n\t\t\t\t\tTMP Get unlimited storage\n\t\t\t\t</a>\n\t\t\t</div>\n'},compiler:[7,">= 4.0.0"],main:function(t,a,e,n,s){var l,i=null!=a?a:{},r=e.helperMissing,o=t.escapeExpression;return'<div class="account-card-container">\n\t<section class="greeting-section">\n'+(null!=(l=t.invokePartial(n.greetings,a,{name:"greetings",data:s,indent:"\t\t",helpers:e,partials:n,decorators:t.decorators}))?l:"")+"\n"+(null!=(l=e.if.call(i,null!=(l=null!=a?a.user:a)?l.isPro:l,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s}))?l:"")+'\t</section>\n\t<section class="user-stats-section">\n\t\t<div class="stat items">\n\t\t\t<div class="label">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.ITEMS"},data:s}))+'</div>\n\t\t\t<div class="count">'+o((e.formatNumber||a&&a.formatNumber||r).call(i,null!=a?a.itemCount:a,{name:"formatNumber",hash:{},data:s}))+'</div>\n\t\t</div>\n\t\t<div class="stat views">\n\t\t\t<div class="label">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"stats.VIEWS"},data:s}))+'</div>\n\t\t\t<div class="count">'+o((e.formatNumber||a&&a.formatNumber||r).call(i,null!=a?a.itemCount:a,{name:"formatNumber",hash:{},data:s}))+'</div>\n\t\t</div>\n\t</section>\n\t<section class="storage-section">\n'+(null!=(l=e.if.call(i,null!=(l=null!=a?a.user:a)?l.isPro:l,{name:"if",hash:{},fn:t.program(3,s,0),inverse:t.program(5,s,0),data:s}))?l:"")+'\t</section>\n\t<section class="menu-section">\n\t\t<ul>\n\t\t\t<li>\n\t\t\t\t<a href="#">\n\t\t\t\t\t'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.FLICKRMAIL"},data:s}))+"\n\t\t\t\t\t<span>"+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{count:(e.formatNumber||a&&a.formatNumber||r).call(i,null!=a?a.unreadCount:a,{name:"formatNumber",hash:{},data:s}),intlName:"notifications.FLICKR_MAIL_COUNT_PAREN"},data:s}))+'</span>\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t\t<li>\n\t\t\t\t<a href="#">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.SETTINGS"},data:s}))+'</a>\n\t\t\t</li>\n\t\t\t<li>\n\t\t\t\t<a href="#">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.HELP"},data:s}))+'</a>\n\t\t\t</li>\n\t\t\t<li>\n\t\t\t\t<a href="#">TMP Logout</a>\n\t\t\t</li>\n\t\t</ul>\n\t</section>\n</div>\n'},usePartial:!0,useData:!0}),n={};t.Array.each(["greetings","pro-badge"],function(a){var e=t.Template.get("hermes/"+a);e&&(n[a]=e)}),t.Template.register("hermes/user-account-card",function(a,s){return s=s||{},s.partials=s.partials?t.merge(n,s.partials):n,e(a,s)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-greetings","hermes-template-pro-badge"]});YUI.add("circle-fill-graph",function(t){var n=Math.PI,e=.01;t.CircleFillGraph=function(i){function r(){C=Date.now(),O=C,F=0,M=0,Q=0,x=0,k=0,m=0,y=0,E=0,S=0,W=0,w=t.AnimationManager.subscribe(o)}function o(){b.clearRect(0,0,v.width,v.height),(function(){var t=Date.now();if(F=(t-O)/1e3,M=(t-C)/1e3,k<I.length){var i,r=I[k],o=k>0?I[k-1]:{durationProportion:0,fillProportion:0},a=p*(r.durationProportion-o.durationProportion);S=W+F/a,i=r.easeFunction?R[r.easeFunction](S):S,y=o.fillProportion+(r.fillProportion-o.fillProportion)*i,S>=1&&(y=r.fillProportion,S=0,W=0,k===m&&k++)}b.beginPath(),b.lineWidth=l,b.strokeStyle=g,b.arc(c.x,c.y,s,0,2*n),b.stroke(),(function(t){for(var i=f*t,r=f,o=0;o<i;o++)!(function(t,i){for(var r,o,a=t/i,u=0,h=0;h<P.length;h++)if(P[h].fillProportion>a){u=h-1;break}var p=P[u],g=u+1<P.length?P[u+1]:p;r=p.value,o=g.value;var I=(a-p.fillProportion)/(g.fillProportion-p.fillProportion),v=Math.ceil(parseInt(r.substring(0,2),16)*(1-I)+parseInt(o.substring(0,2),16)*I),w=Math.ceil(parseInt(r.substring(2,4),16)*(1-I)+parseInt(o.substring(2,4),16)*I),C=Math.ceil(parseInt(r.substring(4,6),16)*(1-I)+parseInt(o.substring(4,6),16)*I);b.beginPath(),b.lineWidth=l,b.strokeStyle="rgba("+v+", "+w+", "+C+")",b.arc(c.x,c.y,s,2*n*t/f+d,2*n*(t+1)/f+d+e),b.stroke()})(o,r)})(y),W=S,E=y,m=k,O=t})(),M>p&&w.detach()}var a,u,l,s,c,f,h,d,p,g,P,I,v,b,w,C,O,F,M,Q,x,k,m,y,E,S,W,R;return R={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t},easeOutElastic:function(t){return(.04-.04/t)*Math.sin(25*t)+1},easeInElastic:function(t){return.04*t/--t*Math.sin(25*t)},easeInOutElastic:function(t){return(t-=.5)<0?(.02+.01/t)*Math.sin(50*t):(.02-.01/t)*Math.sin(50*t)+1}},(function(t){return t=t||{},a=t.containerElement,u=t.dim||{width:a.clientWidth,height:a.clientHeight},l=t.lineWidth||5,s=t.radius||u.width/2-l/2,c=t.pos||{x:u.width/2,y:u.height/2},f=t.segments||60,h=t.fillProportion||.8,d=t.rotOffset||-Math.PI/2,p=t.duration||1,g=t.backgroundStrokeColor||"#eeeeee",P=t.gradient||[{fillProportion:0,value:"5BF4FC"},{fillProportion:.3,value:"5BF4FC"},{fillProportion:.7,value:"FF32C4"},{fillProportion:1,value:"FF32C4"}],I=t.stops||[{durationProportion:1,fillProportion:h}],v=(function(t){var n=document.createElement("canvas"),e=n.getContext("2d"),i=window.devicePixelRatio||1;return t.appendChild(n),n.style.width=u.width+"px",n.style.height=u.height+"px",n.width=u.width*i,n.height=u.height*i,e.scale(i,i),n})(t.containerElement),b=v.getContext("2d"),{start:r}})(i)}},"@VERSION@");YUI.add("user-account-card-view",function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e},loadState:function(){var t=this,o=[],r=this.appContext.getViewer().nsid;return o.push(this.appContext.getModel("person-models",r).then(function(e){t.userModel=e})),o.push(this.appContext.getModel("person-profile-models",r).then(function(e){t.profileModel=e})),o.push(this.appContext.getModel("person-proStatus-models",r).then(function(e){t.proStatusModel=e})),e.Promise.all(o)},buildContainer:function(){var t=parseInt(this.profileModel.getValue("storageUsed"),10)||0,o=parseInt(this.profileModel.getValue("storageTotal"),10)||0;this.setContainerWithTemplate("user-account-card",{user:{isPro:this.userModel.getValue("isPro")},itemCount:this.profileModel.getValue("photoCount"),proSinceDate:this.proStatusModel.getValue("lastStart"),unreadCount:this.profileModel.getValue("unreadMessages"),storageUsedFormatted:e.Handlebars.helpers.friendlyDataSize(t),storageTotalFormatted:e.Handlebars.helpers.friendlyDataSize(o),attrs:{user:{username:this.userModel.getValue("username")}}})},activate:function(){var e=this.get("container");this.graphContainer=e.one(".storage-section .graph"),this.graphContainer&&this.drawStorageGraph()},drawStorageGraph:function(){var t,o;o=(t=parseInt(this.profileModel.getValue("storageUsed"),10)/parseInt(this.profileModel.getValue("storageTotal"),10)||0)>.1?[{durationProportion:.2,fillProportion:.001},{durationProportion:1,fillProportion:t,easeFunction:"easeInOutQuad"}]:[{durationProportion:.2,fillProportion:.001},{durationProportion:.65,fillProportion:.7,easeFunction:"easeOutQuad"},{durationProportion:1,fillProportion:t,easeFunction:"easeInOutQuad"}];new e.CircleFillGraph({containerElement:this.graphContainer.getDOMNode(),lineWidth:3,backgroundStrokeColor:"#e1e1e1",gradient:[{fillProportion:0,value:"5BF4FC"},{fillProportion:.3,value:"33b7ff"},{fillProportion:.7,value:"FF32C4"},{fillProportion:1,value:"FF32C4"}],duration:1.4,stops:o}).start()}})},"@VERSION@",{requires:["hermes-template-user-account-card","circle-fill-graph","intl-number","handlebars-helpers"],langBundles:["common","account-menu","notifications","stats"]});YUI.add("hermes-lang-account-menu",function(o,e){o.Intl.add("hermes/account-menu","en-US",{SPACE_USED:["Using ","${percentage}","% of ","${total}"],SPACE_USED_STYLEGUIDE:["${percentage}","% used of ","${total}"],SPACE_USED_UNLIMITED:["Using ","${used}"," of your unlimited storage"],PHOTO_COUNT_MANY:[{type:"number",valueName:"num"}," photos"],PHOTO_COUNT_ONE:["One photo"],PHOTO_COUNT_NONE:["No photos"],PHOTO_COUNT_1K:[{type:"number",valueName:"num"},"k photos"],ADDMORESPACE:["Add more space"],GOADFREE:["Go Ad Free"],GOPRO:["Go Pro"],GETPRO:["Get Pro"],RESUBSCRIBE_TO_PRO:["Re-subscribe to Pro"],GREETING_CAPTION_SPANISH:["Now you know how to greet people in Spanish"],GREETING_CAPTION_GERMAN:["Now you know how to greet people in German"],GREETING_CAPTION_AUSTRALIAN:["Now you know how to greet people in Australian"],GREETING_CAPTION_DUTCH:["Now you know how to greet people in Dutch"],GREETING_CAPTION_ENGLISH:["Now you know how to greet people in English"],GREETING_CAPTION_ARABIC:["Now you know how to greet people in Arabic"],GREETING_CAPTION_FRENCH:["Now you know how to greet people in French"],GREETING_CAPTION_ITALIAN:["Now you know how to greet people in Italian"],GREETING_CAPTION_SWEDISH:["Now you know how to greet people in Swedish"],GREETING_CAPTION_HAWAIIAN:["Now you know how to greet people in Hawaiian"],GREETING_CAPTION_TAGALOG:["Now you know how to greet people in Tagalog"],GREETING_CAPTION_HEBREW:["Now you know how to greet people in Hebrew"],GREETING_CAPTION_HINDI:["Now you know how to greet people in Hindi"],GREETING_CAPTION_MANDARIN:["Now you know how to greet people in Mandarin"],GREETING_CAPTION_PORTUGUESE:["Now you know how to greet people in Portuguese"],GREETING_CAPTION_ALBANIAN:["Now you know how to greet people in Albanian"],GREETING_CAPTION_ESTONIAN:["Now you know how to greet people in Estonian"],GREETING_CAPTION_GREEK:["Now you know how to greet people in Greek"],GREETING_CAPTION_HUNGARIAN:["Now you know how to greet people in Hungarian"],GREETING_CAPTION_LINGALA:["Now you know how to greet people in Lingala"],GREETING_CAPTION_SWAHILI:["Now you know how to greet people in Swahili"],GREETING_CAPTION_TSHILUBA:["Now you know how to greet people in Tshiluba"],GREETING_CAPTION_TURKISH:["Now you know how to greet people in Turkish"],GREETING_CAPTION_BURMESE:["Now you know how to greet people in Burmese"],GREETING_CAPTION_ICELANDIC:["Now you know how to greet people in Icelandic"],GREETING_CAPTION_ZULU:["Now you know how to greet people in Zulu"],GREETING_CAPTION_KOREAN:["Now you know how to greet people in Korean"],GREETING_CAPTION_IRISH:["Now you know how to greet people in Irish"],GREETING_CAPTION_LATVIAN:["Now you know how to greet people in Latvian"],GREETING_CAPTION_BASQUE:["Now you know how to greet people in Basque"],GREETING_CAPTION_BENGALI:["Now you know how to greet people in Bengali"],GREETING_CAPTION_BULGARIAN:["Now you know how to greet people in Bulgarian"],GREETING_CAPTION_CROATIAN:["Now you know how to greet people in Croatian"],GREETING_CAPTION_CZECH:["Now you know how to greet people in Czech"],GREETING_CAPTION_DANISH:["Now you know how to greet people in Danish"],GREETING_CAPTION_FINNISH:["Now you know how to greet people in Finnish"],GREETING_CAPTION_HOPI:["Now you know how to greet people in Hopi"],GREETING_CAPTION_INDONESIAN:["Now you know how to greet people in Indonesian"],GREETING_CAPTION_KANNADA:["Now you know how to greet people in Kannada"],GREETING_CAPTION_KURDISH:["Now you know how to greet people in Kurdish"],GREETING_CAPTION_LITHUANIAN:["Now you know how to greet people in Lithuanian"],GREETING_CAPTION_MALAYSIAN:["Now you know how to greet people in Malaysian"],GREETING_CAPTION_NORWEGIAN:["Now you know how to greet people in Norwegian"],GREETING_CAPTION_POLISH:["Now you know how to greet people in Polish"],GREETING_CAPTION_ROMANIAN:["Now you know how to greet people in Romanian"],GREETING_CAPTION_RUSSIAN:["Now you know how to greet people in Russian"],GREETING_CAPTION_SERBIAN:["Now you know how to greet people in Serbian"],GREETING_CAPTION_SLOVAKIAN:["Now you know how to greet people in Slovakian"],GREETING_CAPTION_UKRAINIAN:["Now you know how to greet people in Ukrainian"],GREETING_CAPTION_VIETNAMESE:["Now you know how to greet people in Vietnamese"]})},"@VERSION@",{requires:["intl"]});YUI.add("account-menu-view",function(e,t){"use strict";var o=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("account-menu-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},loadState:function(){var t=this,o=[],n=this.appContext.getViewer();return n.signedIn?(t.set("user",{signedIn:!0,csrf:this.appContext.auth.csrf?this.appContext.auth.csrf:""}),o.push(this.appContext.getModel("person-models",n.nsid).then(function(o){var n=o.toJSON();Object.keys(n.buddyicon||{}).forEach(function(e){n.buddyicon[e]||(n.buddyicon[e]=n.buddyicon.default)}),t.set("user",e.merge(t.get("user"),n))})),o.push(t.appContext.getModel("person-profile-models",n.nsid).then(function(o){var n=o.toJSON();n.unreadMessages=parseInt(n.unreadMessages,10),n.storageUsed=parseInt(n.storageUsed,10),n.storageTotal=parseInt(n.storageTotal,10),t.set("user",e.merge(t.get("user"),n))})),e.Promise.all(o)):(t.set("user",{signedIn:!1}),e.Promise.resolve())},buildContainer:function(){return this.setContainerWithTemplate("account-menu",this.toJSON()),this},toJSON:function(){var t=e.merge(this.get("user")),o=this.appContext.lang;return parseInt(t.photoCount,10)>1?t.pluralPhotos=!0:t.pluralPhotos=!1,parseInt(t.photoCount,10)<1&&(t.photoCount=!1),t.photoCount>1e3&&(t.photoCount=Math.round(t.photoCount/1e3),t.oneK=!0),t.isPro&&this.appContext.flipper.isFlipped("enable-all-pros-unlimited-storage")?t.storageTotalFormatted=t.storageTotal<0?"":e.Handlebars.helpers.friendlyDataSize(t.storageTotal):t.hasUnlimitedStorage?t.storageTotalFormatted="":t.has1TB?t.storageTotalFormatted="1TB":t.has2TB?t.storageTotalFormatted="2TB":t.storageTotalFormatted=t.storageTotal<0?"":e.Handlebars.helpers.friendlyDataSize(t.storageTotal),"zh-Hant-HK"===o&&(o="zh-HK"),"vi-vn"===o.toLowerCase()&&(o="vn-VN"),t.storageUsedPercentage=Math.floor(1e3*t.storageUsed/t.storageTotal)/10||"0.0",t.storageUsedFormatted=e.Handlebars.helpers.friendlyDataSize(t.storageUsed),t.barWidth=Math.floor(t.storageUsedPercentage/100*293),t.unreadMessages=t.unreadMessages>9999?"9999+":t.unreadMessages,{user:t,helpLocaleKey:o.replace("-","_")||"en_US",flippers:this.appContext.flipper.toJSON()}},activate:function(){setTimeout(function(){this.get("container").on(["click","keydown"],function(e){"click"!==e.type&&13!==e.keyCode&&32!==e.keyCode||(this.appContext.flipper.isFlipped("enable-2018-user-account-card")?(e.preventDefault(),e.stopPropagation(),this.openUserAccountCard()):!this.accountMenuDialog||this.accountMenuDialog.isClosed?this.openMenu(e):this.closeMenu(e))},this)}.bind(this),350)},openMenu:function(t){var o,n=this.get("container");return t.preventDefault(),t.stopPropagation(),this.fire("open"),this.accountMenuDialog||(o=this.templates("account-menu-card"),this.accountMenuDialog=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,showOverlay:!1,width:322,height:"auto",anchorOffsetHorizontal:5,observePageResize:!0,anchorElement:n.one(".c-account-menu"),keyboardAnchorElement:n.one("a[aria-haspopup=true]"),htmlMessage:o({attrs:this.toJSON()}),positionFixed:!0}),this.showGetProButton()),this.accountMenuDialog.show(),this.on("open",this.showGetProButton),this},openUserAccountCard:function(){var t=this.get("container"),o=new e.Views["user-account-card-view"]({appContext:this.appContext});this.accountMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,preferTop:!0,width:300,height:"auto",autoSizeToContent:!0,anchorOffsetVertical:-6,anchorOffsetHorizontal:5,anchorElement:t.one(".c-account-menu"),keyboardAnchorElement:t.one("a[aria-haspopup=true]"),subview:o,contentPadding:0,preventPageScrollOnScroll:!0,useDefaultKeyboardNavigation:!1}),this.accountMenu.show()},closeMenu:function(e){e&&e.preventDefault(),this.accountMenuDialog&&this.accountMenuDialog.close()},showGetProButton:function(){var t=!1,n=!1,a=[],s=this.appContext.getViewer();a.push(this.appContext.getModel("subscription-info-models",s.nsid).then(function(e){e.getValue("products").forEach(function(e){e.canPurchase&&(t=!0)}),!t&&this.accountMenuDialog.get("container").one(".upgrade")&&this.accountMenuDialog.get("container").one(".upgrade").remove(!0)}.bind(this))),a.push(this.appContext.getModel("subscription-history-list-models",s.nsid).then(function(e){if(e.getValue("subscriptions")){e.getValue("subscriptions").toJSON().forEach(function(e){!e.effectiveEndDate&&!e.nextBillingDate||3!==e.status&&12!==e.status||(n=!0)});(this.get("user").isPro&&this.appContext.flipper.isFlipped("enable-all-pros-unlimited-storage")||this.get("user").hasUnlimitedStorage)&&(n=!0)}}.bind(this))),e.Promise.all(a).then(function(){var e=this.templates("account-menu-card-get-pro-button")({canPurchase:!n&&t,canResubscribe:n});this.accountMenuDialog.get("container").one(".upgrade").replace(e),this.accountMenuDialog.get("container").one(".content").setStyles({height:"auto"})}.bind(this),function(e){o.warn("Error fetching model.",{err:e})})},destructor:function(){this.accountMenuDialog&&(this.accountMenuDialog.destroy(),this.accountMenuDialog=null)}})},"@VERSION@",{requires:["flickr-view","hermes-template-account-menu","hermes-template-account-menu-dialog-styleguide","hermes-template-account-menu-card","hermes-template-account-menu-card-get-pro-button","fluid-droparound-view","subscription-history-list-models","user-account-card-view"],optional:["person-models","person-profile-models"],langBundles:["account-menu","common","autosuggest"]});